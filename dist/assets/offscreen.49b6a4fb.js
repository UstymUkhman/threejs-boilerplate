var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,r=(e,r)=>{for(var i in r||(r={}))n.call(r,i)&&s(e,i,r[i]);if(t)for(var i of t(r))o.call(r,i)&&s(e,i,r[i]);return e};import{V as i}from"./index.d57f6a27.js";import"./vendor.c0d691e0.js";function a(){return new Worker("./assets/worker.ea49f7eb.js",{type:"module"})}class c{constructor(){this.events=new Map,this.worker=new a,this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this)}add(e,t,n){this.events.set(e,{callback:t,params:n})}transfer(e,t){this.worker.postMessage({event:"transfer",params:r({element:e},t)},[e])}post(e,t){var n;const o=null==(n=this.events.get(e))?void 0:n.params;this.worker.postMessage({event:e,params:r(r({},o),t)})}onMessage(e){var t,n;const{name:o,response:s}=e.data,r=null==(n=null==(t=this.events)?void 0:t.get(o))?void 0:n.callback;r&&r(s)}onError(e){console.error(e)}remove(e){this.events.delete(e)}}class p{constructor(e,t,n){this.element=e,this.worker=t,this.proxyId=0,this.id=this.proxyId++;const o=Object.entries(n),{clientWidth:s,clientHeight:r}=this.element;this.worker.post("setEventTarget",{id:this.id}),this.sendSizeEvent(s,r);for(const[i,a]of o)this.element.addEventListener(i,(e=>a(e,this.sendEvent.bind(this))))}sendEvent(e){this.worker.post("handleEvent",{id:this.id,event:e})}sendSizeEvent(e,t){const n=this.element.getBoundingClientRect();this.sendEvent({top:n.top,left:n.left,type:"size",width:e,height:t})}}const l=e=>(t,n)=>{const o={type:t.type};((e,t,n)=>{for(const o of t){const t=o;n[t]=e[t]}})(t,e,o),n(o)},h=l(["button","pointerType","pointerId","ctrlKey","metaKey","shiftKey","clientX","clientY","pageX","pageY"]),d=l(["deltaX","deltaY"]);function v(e,t){e.preventDefault(),d(e,t)}const f=l(["ctrlKey","metaKey","shiftKey","keyCode"]),u=Object.freeze({ArrowLeft:!0,ArrowUp:!0,ArrowRight:!0,ArrowDown:!0});function m(e,t){u[e.code]&&(e.preventDefault(),f(e,t))}function w(e,t){const n=e.touches,o=[];for(let s=n.length;s--;){const{pageX:e,pageY:t}=n[s];o.push({pageX:e,pageY:t})}t({type:e.type,touches:o})}const y=e=>e.preventDefault(),g=(e,t)=>{const n=new c,o=new p(e,n,{contextmenu:y,keydown:m,wheel:v,touchstart:w,touchmove:w,touchend:w,pointerdown:h,pointermove:h,pointerup:h,mousedown:h,mousemove:h,mouseup:h});i.addResizeCallback(((e,t,s)=>{n.post("resize",{width:e,height:t,ratio:s}),o.sendSizeEvent(e,t)})),n.transfer(e.transferControlToOffscreen(),{elementId:o.id,pixelRatio:t})};export{g as initialize};
